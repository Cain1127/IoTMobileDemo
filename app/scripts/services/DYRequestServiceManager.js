'use strict';angular.module('DYRequestServiceManagerModule', [])  .factory('DYRequestServiceManager', function (ENV, $resource, $log, $q, localStorageService) {    var param = function(obj) {      var query = '';      var name, value, fullSubName, subName, subValue, innerObj, i;      for (name in obj) {        value = obj[name];        if (value instanceof Array) {          for (i = 0; i < value.length; ++i) {            subValue = value[i];            fullSubName = name + '[' + i + ']';            innerObj = {};            innerObj[fullSubName] = subValue;            query += param(innerObj) + '&';          }        } else if (value instanceof Object) {          for (subName in value) {            subValue = value[subName];            fullSubName = name + '[' + subName + ']';            innerObj = {};            innerObj[fullSubName] = subValue;            query += param(innerObj) + '&';          }        } else if (value !== undefined && value !== null) {          query += encodeURIComponent(name) + '='            + encodeURIComponent(value) + '&';        }      }      return query.length ? query.substr(0, query.length - 1) : query;    };    return {      getEastTodayNews: function () {        var p = $resource('http://c.m.163.com/nc/article/headline/T1348647909107/0-20.html', {}, {          save: {            method: 'GET',            transformRequest: function(data) {              return angular.isObject(data) && String(data) !== '[object File]'                ? param(data)                : data;            }            ,            headers: {              'Content-Type': 'application/json'            },            timeout: 20000          }        });        return p.save(          {},          function (response) {            if (response) {              console.log("East latest news success : " + JSON.stringify(response));            } else {              console.log("East latest news empty");            }          },function(error){            console.log("East latest news fail : " + JSON.stringify(error));          });      },      getToken: function () {        var p = $resource(ENV.api + 'oauth2/token', {}, {          save: {            method: 'POST',            transformRequest: function(data) {              return angular.isObject(data) && String(data) !== '[object File]'                ? param(data)                : data;            }            ,            headers: {              'Content-Type': 'application/x-www-form-urlencoded'            },            timeout: 20000          }        });        return p.save(          {"grant_type":"client_credentials","client_id":"fM6s3LvPZh9f9ExLButJaTj5ia0a","client_secret":"2BCV3FCEiqYhlGkUqUowCQK25zEa"},          function (response) {            if (response) {              var tokenString = (eval("(" + JSON.stringify(response) + ")")).access_token;              tokenString = 'Bearer ' + tokenString;              localStorageService.set("tokenString", tokenString);              console.log("Token Value : " + JSON.stringify(response));            } else {              console.log("No token data");            }          },function(error){            console.log("Get token error:" + JSON.stringify(error));          });      },      fetchEvents: function () {        var p = $resource(ENV.api + 't/dcpp107.acn/platform/enabler/re/eventType/retrieve/1.0.0/12345', {}, {          get: {            method: 'GET',            transformRequest: function(data) {              return angular.isObject(data) && String(data) !== '[object File]'                ? param(data)                : data;            },            headers: {              'Content-Type': 'application/json',              'tenant':107,              'enterprise':1,              'Authorization':localStorageService.get("tokenString")            },            timeout: 20000          }        });        console.log("fetchEvents from server");        return p.get(          {},          function (response) {            if (response) {              localStorageService.set("events", (eval("(" + JSON.stringify(response) + ")")).eventTypes);              console.log("events:" + JSON.stringify(response));            } else {              console.log("No events data");            }          },function(error){            console.log("Get events error:" + JSON.stringify(error));          });      },      sendTemp: function (pkt) {        var p = $resource(ENV.api + 't/dcpp107.acn/platform/enabler/dcm/deviceDiagnostic/send/1.0.0', {}, {          save: {            method: 'POST',            headers: {              'Authorization':localStorageService.get("tokenString"),              'Content-Type': 'application/json',              'tenantId':107,              'enterprize':1,              'parentBusinessUserId':1,              'device-type':'AliGateway',              'device-id':'AliDevice-1-1',              'transaction-id':'TDC-x00001'            },            timeout: 20000          }        });        console.log("sendTemp from server");        return p.save(pkt, function (response) {          if (response) {            console.log("Successful posting temp:" + JSON.stringify(response));          } else {            console.log("No reposonse data");          }        },function(error){          console.log("Failed to post temp error:" + JSON.stringify(error));        });      }    };  });